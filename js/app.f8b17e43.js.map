{"version":3,"file":"js/app.f8b17e43.js","mappings":"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","sources":["webpack://color-splash/./src/utils/touch.ts","webpack://color-splash/./src/App.vue","webpack://color-splash/./src/utils/event.ts","webpack://color-splash/./src/utils/shader.ts","webpack://color-splash/./src/utils/webgl.ts","webpack://color-splash/./src/utils/splash.ts","webpack://color-splash/./src/App.vue?2a37","webpack://color-splash/./src/App.vue?285c","webpack://color-splash/./src/App.vue?01fe","webpack://color-splash/./src/main.ts","webpack://color-splash/webpack/bootstrap","webpack://color-splash/webpack/runtime/chunk loaded","webpack://color-splash/webpack/runtime/compat get default export","webpack://color-splash/webpack/runtime/define property getters","webpack://color-splash/webpack/runtime/global","webpack://color-splash/webpack/runtime/hasOwnProperty shorthand","webpack://color-splash/webpack/runtime/jsonp chunk loading","webpack://color-splash/webpack/startup"],"sourcesContent":["import XEvent from \"./event\";\n\nexport enum TOUCH_TYPE {\n  SINGLE_TOUCH, // 单指\n  DOUBLE_TOUCH // 双指\n}\n\ninterface TouchParam {\n  diffX: number,\n  diffY: number,\n  offsetX: number,\n  offsetY: number\n}\n\ninterface TouchCheckParam {\n  offsetX: number,\n  offsetY: number\n}\n\nconst eventList = ['touchStart', 'touchMove', 'touchEnd'] as const;\n\nexport default class TouchListener extends XEvent<typeof eventList> {\n  touchType = TOUCH_TYPE.SINGLE_TOUCH;\n  TOUCH_TYPE = TOUCH_TYPE;\n  private curTouch: undefined | { x: number, y: number }[] = undefined;\n  private touchTimer: undefined | number = undefined;\n  checkValid: undefined | ((param: TouchCheckParam) => boolean) = undefined;\n  private rect: DOMRect;\n  private offsetTop: number;\n  private offsetLeft: number;\n  elm: Element;\n\n  constructor(elm: HTMLCanvasElement) {\n    super(eventList);\n    this.elm = elm;\n    this.rect = elm.getBoundingClientRect();\n    this.offsetTop = this.rect.top;\n    this.offsetLeft = this.rect.left;\n\n    this.elm.addEventListener('touchstart', this.onTouchStart);\n    this.elm.addEventListener('touchmove', this.onTouchMove);\n    this.elm.addEventListener('touchend', this.onTouchEnd)\n  }\n\n  private onTouchStart = (e: Event) => {\n    e.preventDefault();\n    this.curTouch = undefined;\n    window.clearTimeout(this.touchTimer);\n    this.touchTimer = window.setTimeout(() => { // 双指不一定同时触发，设一个timeout\n      const { touches } = e as TouchEvent;\n      if (!touches.length || touches.length > 2) return;\n      const touch0 = touches[0];\n      const touch1 = touches[1];\n\n      const ret = this.checkValid ? this.checkValid({\n        offsetX: touch0.clientX - this.offsetLeft,\n        offsetY: touch0.clientY - this.offsetTop\n      }) : true;\n      if (!ret) return;\n      if (touches.length === 1) {\n        this.touchType = TOUCH_TYPE.SINGLE_TOUCH;\n        this.curTouch = [{ x: touch0.clientX, y: touch0.clientY }];\n      } else if (touches.length === 2) {\n        this.touchType = TOUCH_TYPE.DOUBLE_TOUCH;\n        this.curTouch = [\n          { x: touch0.clientX, y: touch0.clientY },\n          { x: touch1.clientX, y: touch1.clientY }\n        ];\n      }\n    }, 100);\n  };\n\n  private onTouchMove = (e: Event) => {\n    e.preventDefault()\n    if (this.curTouch) {\n      const { touches } = e as TouchEvent;\n      const touch0 = touches[0];\n      const touch1 = touches[1];\n      if (this.touchType === TOUCH_TYPE.SINGLE_TOUCH && touch0) {\n        this.emit('touchMove', {\n          touches: [\n            { x: touch0.clientX - this.offsetLeft, y: touch0.clientY - this.offsetTop },\n          ],\n          preTouches: [\n            { x: this.curTouch[0].x - this.offsetLeft, y: this.curTouch[0].y - this.offsetTop },\n          ]\n        });\n        this.curTouch[0].x = touch0.clientX;\n        this.curTouch[0].y = touch0.clientY;\n      } else if (this.touchType === TOUCH_TYPE.DOUBLE_TOUCH && touch0 && touch1) {\n        this.emit('touchMove', {\n          touches: [\n            { x: touch0.clientX - this.offsetLeft, y: touch0.clientY - this.offsetTop },\n            { x: touch1.clientX - this.offsetLeft, y: touch1.clientY - this.offsetTop }\n          ],\n          preTouches: [\n            { x: this.curTouch[0].x - this.offsetLeft, y: this.curTouch[0].y - this.offsetTop },\n            { x: this.curTouch[1].x - this.offsetLeft, y: this.curTouch[1].y - this.offsetTop },\n          ]\n        });\n        this.curTouch[0].x = touch0.clientX;\n        this.curTouch[0].y = touch0.clientY;\n        this.curTouch[1].x = touch1.clientX;\n        this.curTouch[1].y = touch1.clientY;\n      }\n    }\n  }\n\n  private onTouchEnd = (e: Event) => {\n    e.preventDefault()\n    if (this.curTouch) {\n      this.emit('touchEnd', {\n        x: this.curTouch[0].x - this.offsetLeft,\n        y: this.curTouch[0].y - this.offsetTop\n      });\n    }\n  }\n\n  clear = () => {\n    this.elm.removeEventListener('touchstart', this.onTouchStart);\n    this.elm.removeEventListener('touchmove', this.onTouchMove);\n    this.elm.removeEventListener('touchend', this.onTouchEnd);\n    this.clear();\n  };\n}","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{attrs:{\"id\":\"app\"}},[_c('div',{style:(_vm.containerStyle),attrs:{\"id\":\"color-splash\"}}),_c('div',{staticClass:\"btn-list\"},[_c('div',{staticClass:\"btn\"},[_vm._v(\" 选择图片 \"),_c('input',{attrs:{\"id\":\"select-photo\",\"type\":\"file\",\"accept\":\"image/*\"},on:{\"change\":_vm.selectImage}})]),_c('div',{staticClass:\"btn\",class:{ actived: _vm.mode === _vm.SPLASH_MODE.COLOR },on:{\"click\":function($event){return _vm.switchMode(_vm.SPLASH_MODE.COLOR)}}},[_vm._v(\" 涂色 \")]),_c('div',{staticClass:\"btn\",class:{ actived: _vm.mode === _vm.SPLASH_MODE.GRAY },on:{\"click\":function($event){return _vm.switchMode(_vm.SPLASH_MODE.GRAY)}}},[_vm._v(\" 涂灰 \")]),_c('div',{staticClass:\"btn\",class:{ actived: _vm.mode === _vm.SPLASH_MODE.MOVE },on:{\"click\":function($event){return _vm.switchMode(_vm.SPLASH_MODE.MOVE)}}},[_vm._v(\" 移动/缩放 \")]),_c('div',{staticClass:\"btn\",on:{\"click\":_vm.onSave}},[_vm._v(\" 保存 \")])]),(_vm.showRet)?_c('div',{staticClass:\"save\"},[_c('img',{attrs:{\"src\":_vm.saveData,\"alt\":\"img\"}}),_c('div',{staticClass:\"tips\"},[_vm._v(\" 请长按图片保存 \")]),_c('div',{staticClass:\"close\",on:{\"click\":function($event){_vm.showRet = false}}},[_c('svg',{attrs:{\"width\":\"100%\",\"height\":\"100%\"}},[_c('line',{attrs:{\"x1\":\"0\",\"y1\":\"0\",\"x2\":\"100%\",\"y2\":\"100%\",\"stroke\":\"#FFFFFF\",\"stroke-linecap\":\"round\"}}),_c('line',{attrs:{\"x1\":\"100%\",\"y1\":\"0\",\"x2\":\"0\",\"y2\":\"100%\",\"stroke\":\"#FFFFFF\",\"stroke-linecap\":\"round\"}})])])]):_vm._e()])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/* eslint-disable @typescript-eslint/no-explicit-any */ \ntype CallBack = ((...arg: any) => any) | undefined\ntype EventMap = { [key: number | string]: CallBack }\n\nexport default class XEvent<T extends string[] | readonly string[]> {\n  private uidMap: { [key: string]: number } = {};\n  private eventMap: { [key: string]: EventMap } = {};\n  eventList: T;\n  on: (name: T[number], cb: CallBack) => number;\n  off: (name: T[number] , uid: number) => void;\n  emit: (name: T[number] , ...arg: any) => void;\n  clear: (name?: T[number]) => void;\n\n  constructor(nameList: T) {\n    this.eventList = nameList;\n    this.eventList.forEach(name => {\n      this.uidMap[name] = 0;\n      this.eventMap[name] = {};\n    });\n\n    this.on = (name: T[number], cb: CallBack): number => {\n      const events = this.eventMap[name];\n      const cuid = this.uidMap[name];\n      if (events && cuid !== undefined && cuid >= 0) {\n        events[cuid] = cb;\n        this.uidMap[name] = cuid + 1;\n        return cuid;\n      }\n      return -1;\n    };\n\n    this.off = (name: T[number], uid: number): void => {\n      const events = this.eventMap[name];\n      if (events && events[uid]) {\n        events[uid] = undefined;\n        delete events[uid];\n      }\n    };\n\n    this.emit = (name: T[number], ...arg: any): void => {\n      const events = this.eventMap[name];\n      if (events) {\n        Object.keys(events).forEach(key => {\n          const fn = events[key];\n          if (fn) fn(...arg);\n        });\n      }\n    }\n\n    this.clear = (name?: T[number]): void => {\n      if (name && this.eventMap[name]) {\n        this.eventMap[name] = {};\n        this.uidMap[name] = 0;\n      } else {\n        Object.keys(this.eventMap).forEach(key => {\n          this.eventMap[key] = {};\n          this.uidMap[key] = 0;\n        })\n      }\n    }\n  }\n}","// a_position: 顶点位置\n// a_texCoord: 纹理坐标[-1, 1]\n// v_texCoord: 从顶点着色器传数据到片元着色器的变量\n// u_projection: 从canva坐标系转换成webgl坐标系的变换举证\n// u_rotate: 旋转矩阵\n// u_translate: 平移矩阵\nexport const vertextSource = `\n  attribute vec2 a_position;\n  attribute vec2 a_texCoord;\n  varying vec2 v_texCoord;\n  uniform mat4 u_projection;\n  uniform mat4 u_rotate;\n  uniform mat4 u_translate;\n  uniform mat4 u_scale;\n  void main(void) {\n    gl_Position = u_projection * u_translate * u_rotate * u_scale * vec4(a_position, 0, 1.0);\n    v_texCoord = a_texCoord;\n  }\n`;\n\n// precision mediump float 设置精度\n// v_texCoord: 从顶点着色器传过来的变量\n// u_image: 图片\nexport const fragmentSource = `\n  precision mediump float;\n  varying vec2 v_texCoord;\n  uniform sampler2D u_image;\n  uniform sampler2D u_image_patch;\n\n  void main() {\n    vec4 texture = texture2D(u_image, v_texCoord);\n    vec4 patch = texture2D(u_image_patch, v_texCoord);\n    bool flag = true;\n    if (patch.r > 0.0) {\n      float gray = 0.299 * texture.r + 0.587 * texture.g + 0.114 * texture.b;\n      gl_FragColor = vec4(gray, gray, gray, texture.a);\n    } else {\n      gl_FragColor = texture;\n    }\n  }\n`;\n\nexport const splashVertextSource = `\n  attribute vec2 a_position;\n  uniform mat4 u_projection;\n  uniform mat4 u_rotate;\n  uniform mat4 u_scale;\n  uniform mat4 u_translate1;\n  uniform mat4 u_translate2;\n  void main(void) {\n    gl_Position = u_projection * u_translate2 * u_scale * u_rotate * u_translate1 * vec4(a_position, 0, 1.0);\n  }\n`;\n\nexport const splashFragmentSource = `\n  precision mediump float;\n  uniform int u_mode;\n\n  void main() {\n    if (u_mode == 1) {\n      gl_FragColor = vec4(1, 1, 1, 1);\n    }else {\n      gl_FragColor = vec4(0, 0, 0, 0);\n    }\n  }\n`;\n\nexport const pickVertextSource = `\n  attribute vec2 a_position;\n  uniform mat4 u_projection;\n  uniform mat4 u_rotate;\n  uniform mat4 u_translate;\n  uniform mat4 u_scale;\n  void main(void) {\n    gl_Position = u_projection * u_translate * u_rotate * u_scale * vec4(a_position, 0, 1.0);\n  }\n`;\n\nexport const pickFragmentSource = `\n  precision mediump float;\n  uniform vec4 u_id;\n\n  void main() {\n    gl_FragColor = u_id;\n  }\n`;\n\nexport const previewVertextSource = `\n  attribute vec2 a_position;\n  uniform mat4 u_projection;\n  attribute vec2 a_texCoord;\n  varying vec2 v_texCoord;\n\n  void main(void) {\n    gl_Position = u_projection * vec4(a_position, 0, 1.0);\n    v_texCoord = a_texCoord;\n  }\n`;\n\nexport const previewFragmentSource = `\n  precision mediump float;\n  varying vec2 v_texCoord;\n  uniform sampler2D u_image;\n\n  void main() {\n    vec4 texture = texture2D(u_image, v_texCoord);\n    gl_FragColor = texture;\n  }\n`;\n\n// 实心圆用TRIANGLE_FAN画，第一个顶点需要时圆心，此时a_flag设置为0.0，其余圆周上的点a_flag设置1.0\n// 空心圆用LINE_LOOP画，所有点都是圆周上的点\nexport const circleVertextSource = `\n  attribute float a_radian;\n  attribute float a_flag;\n  uniform mat4 u_projection;\n  uniform float u_radius;\n  uniform mat4 u_translate;\n\n  void main(void) {\n    gl_Position = u_projection * u_translate * vec4(a_flag * u_radius * cos(a_radian), a_flag * u_radius * sin(a_radian), 0, 1.0);\n  }\n`;\n\nexport const colorFragmentSource = `\n  precision mediump float;\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n`;","import { circleVertextSource, colorFragmentSource } from './shader';\n\nconst webgl = window.document.createElement('canvas').getContext('webgl');\nexport const support = !!webgl && webgl instanceof WebGLRenderingContext;\n\nlet circleProgram: WebGLProgram;\n\ndeclare global {\n  interface WebGLRenderingContext {\n    [key: string]: number\n  }\n}\n\nexport const createProgram = (gl: WebGLRenderingContext, vSource: string, fSource: string): null | WebGLProgram => {\n  // 编译shader\n  const vertextShader = gl.createShader(gl.VERTEX_SHADER);\n  const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  if (!vertextShader || !fragmentShader) return null;\n  gl.shaderSource(vertextShader, vSource);\n  gl.shaderSource(fragmentShader, fSource);\n  gl.compileShader(vertextShader);\n  gl.compileShader(fragmentShader);\n  // 创建program\n  const program = gl.createProgram();\n  if (!program) return null;\n  gl.attachShader(program, vertextShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  return program;\n};\n\nexport function createFrameBuffer (gl: WebGLRenderingContext): null | WebGLFramebuffer\nexport function createFrameBuffer (gl: WebGLRenderingContext, texture: WebGLTexture | null ): null | WebGLFramebuffer\nexport function createFrameBuffer (gl: WebGLRenderingContext, width: number, height: number ): null | WebGLFramebuffer\nexport function createFrameBuffer (gl: WebGLRenderingContext, arg1?: number | WebGLTexture | null, arg2?: number): null | WebGLFramebuffer {\n  const frameBuffer = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n  if (arg1 !== undefined && typeof arg1 !== 'number' && arg2 === undefined) {\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, arg1, 0);\n  } else if (typeof arg1 === 'number' || arg1 === undefined) {\n    const w = arg1 || gl.canvas.width;\n    const h = arg2 || gl.canvas.height;\n    const curTexture = gl.getParameter(gl.TEXTURE_BINDING_2D);\n    // 为帧缓存声明纹理空间\n    const texture = createTexture(gl);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    // 将纹理绑定到帧缓存对应的附着点上\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n    gl.bindTexture(gl.TEXTURE_2D, curTexture);\n  }\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  return frameBuffer;\n}\n\nexport function createTexture (gl: WebGLRenderingContext): WebGLTexture | null\nexport function createTexture (gl: WebGLRenderingContext, source: TexImageSource): WebGLTexture | null\nexport function createTexture (gl: WebGLRenderingContext, source: ArrayBufferView | null, width: number, height: number): WebGLTexture | null\nexport function createTexture (gl: WebGLRenderingContext, source?: TexImageSource | ArrayBufferView | null, width?: number, height?: number): WebGLTexture | null {\n  const texture = gl.createTexture();\n  if (!texture) return null;\n  configTeture(gl, texture, source, width, height);\n\n  return texture;\n}\n\nexport function configTeture (gl: WebGLRenderingContext, texture: WebGLTexture | null, source?: TexImageSource | ArrayBufferView | null, width?: number, height?: number): void {\n  // 绑定纹理到当前操作对象\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  // 纹理属性设置\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  if (width && height) {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, source as (ArrayBufferView | null));\n  } else if (source) {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source as TexImageSource);\n  }\n}\n\nexport function setTexture (gl: WebGLRenderingContext, program: WebGLProgram, texture: WebGLTexture | null, uniform: string, index: number): void\nexport function setTexture (gl: WebGLRenderingContext, program: WebGLProgram, texture: WebGLTexture | null, uniform: string, index: number, source: TexImageSource): void\nexport function setTexture (gl: WebGLRenderingContext, program: WebGLProgram, texture: WebGLTexture | null, uniform: string, index: number, source: ArrayBufferView | null, width: number, height: number): void\nexport function setTexture (gl: WebGLRenderingContext, program: WebGLProgram, texture: WebGLTexture | null, uniform: string, index: number, source?: TexImageSource | ArrayBufferView | null, width?: number, height?: number): void {\n  gl.useProgram(program);\n  // 获取着色器中的uniform变量，并指示其将从纹理0中获取值\n  const uImage = gl.getUniformLocation(program, uniform);\n  gl.uniform1i(uImage, index);\n  gl.activeTexture(gl[`TEXTURE${index}`]);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  // 在texture上填充纹理，同时也会在着色器中赋值给u_image\n  if (width && height) {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, source as (ArrayBufferView | null));\n  } else if (source) {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source as TexImageSource);\n  }\n}\n\nexport const setAttribute = (gl: WebGLRenderingContext, program: WebGLProgram, data: number[], attribute: string, drawType: number, size = 2): void => {\n  // 创建一个buff\n  const buffer = gl.createBuffer();\n  // 绑定buff到当前操作空间，并把值传给当前buff\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), drawType);\n  // 获取顶点属性的在着色器中的索引，并激活它\n  const aLocation = gl.getAttribLocation(program, attribute);\n  gl.enableVertexAttribArray(aLocation);\n  // 设置顶点属性如何从顶点缓冲对象中取值。每次从数组缓冲对象中读取2个值\n  gl.vertexAttribPointer(aLocation, size, gl.FLOAT, false, 0, 0);\n};\n\nexport const setUniformMat = (gl: WebGLRenderingContext, program: WebGLProgram, data: number[], uniform: string): void => {\n  const uniformLocation = gl.getUniformLocation(program, uniform);\n  gl.uniformMatrix4fv(uniformLocation, false, data);\n};\n\nexport const setUniformVec4 = (gl: WebGLRenderingContext, program: WebGLProgram, uniform: string, data: number[]): void => {\n  const uniformLocation = gl.getUniformLocation(program, uniform);\n  gl.uniform4f(uniformLocation, data[0] || 0, data[1] || 0, data[2] || 0, data[3] || 0);\n};\n\nexport const getObjUid = (index: number): number[] => {\n  return [ // 将1拆分成4个部分，每部分8个字节，最大值是255，同时除255(0xff)，归一化，因为webgl绘制的时候颜色范围是0-1\n    ((index >>  0) & 0xFF) / 0xFF,\n    ((index >>  8) & 0xFF) / 0xFF,\n    ((index >> 16) & 0xFF) / 0xFF,\n    ((index >> 24) & 0xFF) / 0xFF,\n  ];\n};\n\nexport const isObjUidMatch = (index: number, uid: number[] | Uint8Array | Uint16Array | Uint32Array) => {\n  const id = uid[0] + (uid[1] << 8) + (uid[2] << 16) + (uid[3] << 24);\n  return id === index;\n};\n\nexport const createProjectionMat = (left: number, right: number, top: number, bottom: number): number[] => {\n  // 坐标变换矩阵\n  // 由于webgl是列为主的顺序，也就是说数组头4个是第一列，接着4个是第二列，如此类推\n  return [\n    2 / (right - left), 0, 0, 0,\n    0, -2 / (bottom - top), 0, 0,\n    0, 0, 2, 0,\n    -(right + left) / (right - left), (top + bottom) / (bottom - top), -1, 1\n  ]\n};\n\nexport const createRotateMat = (rotate: number): number[] => { // 旋转矩阵\n  rotate = rotate * Math.PI / 180;\n  const cos = Math.cos(rotate);\n  const sin = Math.sin(rotate);\n  return [\n    cos, sin, 0, 0,\n    -sin, cos, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  ]\n};\n\nexport const createTranslateMat = (x: number, y: number): number[] => { // 平移矩阵\n  return [\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    x, y, 0, 1\n  ]\n};\n\nexport const createScaleMat = (scale: number): number[] => { // 平移矩阵\n  return [\n    scale, 0, 0, 0,\n    0, scale, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  ]\n};\n\n// export const creaateCircleVertext = (center: { x: number, y: number }, radius: number, count: number) => {\n//   const list = [];\n//   for (let i = 0; i <= )\n// }\n\nexport const DrawCube = (\n  gl: WebGLRenderingContext,\n  program: WebGLProgram,\n  frameBuffer: WebGLFramebuffer | null,\n  attributes?: { mat: number[], name: string, drawType: number }[],\n  uniforms?: { mat: number[], name: string }[],\n  width?: number,\n  height?: number,\n  keep?: boolean,\n) => {\n  const w = width || gl.canvas.width;\n  const h = height || gl.canvas.height;\n  gl.viewport(0, 0, w, h);\n  gl.useProgram(program),\n  // 通过bindFramebuffer声明接下来绘制将发生在buffer上\n  // bindFramebuffer绑定null，则绘制在canvas上\n  gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n  uniforms?.forEach(uniform => {\n    setUniformMat(gl, program, uniform.mat, uniform.name);\n  });\n  attributes?.forEach(attribute => {\n    setAttribute(gl, program, attribute.mat, attribute.name, attribute.drawType);\n  });\n  if (!keep) {\n    gl.clearColor(0, 0, 0, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  }\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  if (frameBuffer) gl.bindFramebuffer(gl.FRAMEBUFFER, null); // 将当前绘制空间重新指定为canvas\n}\n\nexport const DrawCircle = (\n  gl: WebGLRenderingContext,\n  frameBuffer: WebGLBuffer | null,\n  x: number, y: number, radius: number,\n  r: number, g: number, b: number, a: number,\n  count = 20,\n  fill = false,\n  projMat?: number[] | null,\n  width?: number,\n  height?: number,\n) : void => {\n  circleProgram = circleProgram || createProgram(gl, circleVertextSource, colorFragmentSource);\n  if (!circleProgram) return;\n  if (a !== 1) {\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n  }\n  gl.useProgram(circleProgram);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n  const w = width || gl.canvas.width;\n  const h = height || gl.canvas.height;\n  gl.viewport(0, 0, w, h);\n  setUniformMat(gl, circleProgram, projMat || createProjectionMat(0, gl.canvas.width, 0, gl.canvas.height), 'u_projection');\n  setUniformMat(gl, circleProgram, createTranslateMat(x, y), 'u_translate');\n  setUniformVec4(gl, circleProgram, 'u_color', [r, g, b, a]);\n  const radiusLoc = gl.getUniformLocation(circleProgram, 'u_radius');\n  gl.uniform1f(radiusLoc, radius);\n  const radianUnit = 2 * Math.PI / count;\n  const radianData: number[] = [];\n  const flagData: number[] = [];\n  for (let i = 0; i < count; i += 1) {\n    radianData.push(i * radianUnit);\n    flagData.push(1);\n  }\n  let drawShape = gl.LINE_LOOP;\n  let drawCount = count;\n  if (fill) {\n    radianData.unshift(0);\n    flagData.push(0);\n    drawShape = gl.TRIANGLE_FAN;\n    drawCount = radianData.length - 1;\n  }\n  setAttribute(gl, circleProgram, radianData, 'a_radian', gl.STATIC_DRAW, 1);\n  setAttribute(gl, circleProgram, flagData, 'a_flag', gl.STATIC_DRAW, 1);\n  gl.drawArrays(drawShape, 0, drawCount);\n  if (frameBuffer) gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  if (a !== 1) {\n    gl.disable(gl.BLEND);\n  }\n};\n\nexport const clear = (gl: WebGLRenderingContext, frameBuffer: WebGLFramebuffer | null, r: number, g: number, b: number, a: number): void => {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n  gl.clearColor(r, g, b, a);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n}","import TouchListener from './touch';\n// import './splash.css';\nimport {\n  vertextSource, fragmentSource,\n  pickVertextSource, pickFragmentSource,\n  splashVertextSource, splashFragmentSource,\n  previewVertextSource, previewFragmentSource\n} from './shader';\nimport * as WEBGL from './webgl';\nimport XEvent from './event';\n\nconst splashEvent = ['splash-switch'] as const;\nclass SplashEvent extends XEvent<typeof splashEvent> {}\n\nexport interface SplashOptions {\n  elm?: Element,\n}\n\nexport interface Splash {\n  reset: (src: HTMLImageElement) => void,\n  destroy: () => void,\n  SPLASH_MODE: typeof SPLASH_MODE,\n  switch: (m: SPLASH_MODE) => void,\n  output: () => string | undefined,\n  event: {\n    on: SplashEvent['on'],\n    off: SplashEvent['off']\n  }\n}\n\nexport enum SPLASH_MODE {\n  MOVE,\n  COLOR,\n  GRAY\n}\n\nconst initWebgl = (canvas: HTMLCanvasElement): Splash | undefined => {\n  const gl = canvas.getContext('webgl');\n  if (!gl) return;\n  // gl.enable(gl.DEPTH_TEST);\n  // gl.depthFunc(gl.LEQUAL);\n  const event = new SplashEvent(splashEvent);\n  // 绘制变量\n  const size = {\n    width: 0,\n    height: 0\n  };\n  const translate = {\n    x: 0,\n    y: 0\n  };\n  let rotate = 0;\n  let scale = 1;\n  const minScale = 0.5;\n  const maxScale = 3;\n  const splashSize = 5;\n  let mode = SPLASH_MODE.MOVE;\n  const saveInfo: {\n    canvas: HTMLCanvasElement | null,\n    gl: WebGLRenderingContext | null,\n    drawProgram: WebGLProgram | null,\n    texTure: WebGLTexture | null,\n  } = {\n    canvas: null,\n    gl: null,\n    drawProgram: null,\n    texTure: null,\n  };\n  const sourceInfo = { width: 0, height: 0, patchW: 0, patchH: 0, src: null as (HTMLImageElement | null) };\n  // 创建webgl program\n  const program = WEBGL.createProgram(gl, vertextSource, fragmentSource);\n  const pickProgram = WEBGL.createProgram(gl, pickVertextSource, pickFragmentSource); // 判断点击时是否击中图片\n  const patchProgram = WEBGL.createProgram(gl, splashVertextSource, splashFragmentSource); // 灰度或彩色化像素\n  const previewProgram = WEBGL.createProgram(gl, previewVertextSource, previewFragmentSource);\n  const frameBuffer = WEBGL.createFrameBuffer(gl);\n  let patchBuffer: WebGLFramebuffer | null;\n  let patchTexture: WebGLTexture | null;\n  const touchListener = new TouchListener(canvas);\n  const picTexture = WEBGL.createTexture(gl);\n  if (!program || !pickProgram || !frameBuffer || !patchProgram || !picTexture || !previewProgram) return;\n  // 设置不变的矩阵\n  // 纹理坐标，原点在图片左下角\n  // 由于采用TRIANGLE_STRIP绘图，坐标需要是Z字形排列\n  const aTexCoord = [\n    0.0, 0.0, // 左下\n    1.0, 0.0, // 右下\n    0.0, 1.0, // 左上\n    1.0, 1.0, // 右上\n  ];\n  const projectionMat = WEBGL.createProjectionMat(0, gl.canvas.width, 0, gl.canvas.height);\n  // 不变的变量\n  gl.useProgram(program);\n  WEBGL.setUniformMat(gl, program, projectionMat, 'u_projection');\n  // 不变的变量\n  gl.useProgram(pickProgram);\n  WEBGL.setUniformMat(gl, pickProgram, projectionMat, 'u_projection');\n  const uid = WEBGL.getObjUid(1);\n  WEBGL.setUniformVec4(gl, pickProgram, 'u_id', uid);\n  // 不变的变量\n  gl.useProgram(previewProgram);\n  WEBGL.setUniformMat(gl, previewProgram, projectionMat, 'u_projection');\n  const scaleUnitW = gl.canvas.width / 5;\n  const scaleUnitH = gl.canvas.height / 5;\n  const previewRect = {\n    left: Math.round(scaleUnitW * 3.2),\n    right: Math.round(scaleUnitW * 4.7),\n    top: Math.round(scaleUnitH * 3.5),\n    bottom: Math.round(scaleUnitH * 4.8),\n    width: 0,\n    height: 0\n  };\n  previewRect.width = previewRect.right - previewRect.left;\n  previewRect.height = previewRect.bottom - previewRect.top;\n  const previewAPosData = [\n    previewRect.left, previewRect.bottom,\n    previewRect.right, previewRect.bottom,\n    previewRect.left, previewRect.top,\n    previewRect.right, previewRect.top,\n  ];\n\n  const updateDraw = () => {\n    // 绘制时，让图片中心与canvas左上角重叠\n    const left =  -size.width / 2;\n    const right = size.width / 2;\n    const top = -size.height / 2;\n    const bottom = size.height / 2;\n    const aPosData = [\n      left, top,\n      right, top,\n      left, bottom,\n      right, bottom,\n    ];\n    const roateMat = WEBGL.createRotateMat(rotate);\n    const translateMat = WEBGL.createTranslateMat(translate.x, translate.y);\n    const scaleMat = WEBGL.createScaleMat(scale);\n    // 绘制两次，一次在framebuffer上，一次在canvas上，保持两者变换一致\n    // framebuffer的用来判断点击是否点中图形\n    WEBGL.DrawCube(\n      gl, pickProgram, frameBuffer,\n      [{ mat: aPosData, name: 'a_position', drawType: gl.DYNAMIC_DRAW }],\n      [{ mat: translateMat, name: 'u_translate' }, { mat: roateMat, name: 'u_rotate' }, { mat: scaleMat, name: 'u_scale' }],\n    );\n    WEBGL.DrawCube(\n      gl, program, null,\n      [{ mat: aPosData, name: 'a_position', drawType: gl.DYNAMIC_DRAW }, { mat: aTexCoord, name: 'a_texCoord', drawType: gl.STATIC_DRAW }],\n      [{ mat: translateMat, name: 'u_translate' }, { mat: roateMat, name: 'u_rotate' }, { mat: scaleMat, name: 'u_scale' }],\n    );\n  };\n\n  const resetImage = (source: HTMLImageElement) => {\n    const ratioW = gl.canvas.width / source.width;\n    const ratioH = gl.canvas.height / source.height;\n    const ratio = Math.min(ratioW, ratioH);\n    size.width = source.width * ratio;\n    size.height = source.height * ratio;\n    sourceInfo.width = source.width;\n    sourceInfo.height = source.height;\n    sourceInfo.patchW = size.width;\n    sourceInfo.patchH = size.height;\n    sourceInfo.src = source;\n    translate.x = gl.canvas.width / 2;\n    translate.y = gl.canvas.height / 2;\n    rotate = 0;\n    scale = 1;\n    patchTexture = WEBGL.createTexture(gl, null, size.width, size.height);\n    patchBuffer = WEBGL.createFrameBuffer(gl, patchTexture);\n    WEBGL.setTexture(gl, program, picTexture, 'u_image', 0, source);\n    WEBGL.setTexture(gl, program, patchTexture, 'u_image_patch', 1);\n    WEBGL.clear(gl, patchBuffer, 1, 1, 1, 1);\n    switchMode(SPLASH_MODE.COLOR);\n    // updateDraw();\n  };\n\n  const patchDraw = (p1: {x: number, y: number}, p2: {x: number, y: number}) => {\n    // 由于patchdraw的结果会作为纹理，再下次绘制图片的过程中叠加进去，而纹理和webgl的y轴是相反的，所以投影矩阵，y也得反过来\n    // 同时由于涂色是发生在缩小放大之后，实际的矩阵变换应该是放大缩小之后的宽高\n    const width = size.width * scale;\n    const height = size.height * scale;\n    const projMat = WEBGL.createProjectionMat(0, width, height, 0);\n    // 由于此时的point是在已经做过旋转平移后的图片基础上获取到的point，需要还原之前的操作\n    // 还原1，先平移回原点\n    const translateMat1 = WEBGL.createTranslateMat(-translate.x, -translate.y);\n    // 还原2，旋转回原角度\n    const roateMat = WEBGL.createRotateMat(-rotate);\n    // 还原3，还原缩放大小\n    const scaleMat = WEBGL.createRotateMat(1 / scale);\n    // 还原后，移动图片，让其左上角与canvas重叠\n    const translateMat2 = WEBGL.createTranslateMat(width / 2, height / 2);\n    // 计算两点间向量\n    let p1p2 = { x: p2.x - p1.x, y: p2.y - p1.y };\n    const len = Math.sqrt(Math.pow(p1p2.x, 2) + Math.pow(p1p2.y, 2));\n    p1p2 = { x: p1p2.x / len, y: p1p2.y / len }; // 归一\n    const v1 = { x: p1p2.y * splashSize, y: -p1p2.x * splashSize }; // 与v垂直的一侧向量，长度splashSize\n    const v2 = { x: -p1p2.y * splashSize, y: p1p2.x * splashSize }; // 与v垂直的另一侧向量，长度splashSize\n\n    // 向量p1p2，p1作为起点，需要往反方向扩展splashSize的长度\n    const p1v1 = { x: v1.x + p1.x - p1p2.x * splashSize, y: v1.y + p1.y - p1p2.y * splashSize };\n    const p1v2 = { x: v2.x + p1.x - p1p2.x * splashSize, y: v2.y + p1.y - p1p2.y * splashSize };\n    // 向量p1p2，p2作为终点，需要往正方向扩展splashSize的长度\n    const p2v1 = { x: v1.x + p2.x + p1p2.x * splashSize, y: v1.y + p2.y + p1p2.y * splashSize };\n    const p2v2 = { x: v2.x + p2.x + p1p2.x * splashSize, y: v2.y + p2.y + p1p2.y * splashSize };\n\n    const aPosData = [\n      p1v1.x, p1v1.y,\n      p1v2.x, p1v2.y,\n      p2v1.x, p2v1.y,\n      p2v2.x, p2v2.y,\n    ];\n\n    WEBGL.DrawCube(\n      gl, patchProgram, patchBuffer,\n      [{ mat: aPosData, name: 'a_position', drawType: gl.DYNAMIC_DRAW }],\n      [\n        { mat: projMat, name: 'u_projection' },\n        { mat: roateMat, name: 'u_rotate' },\n        { mat: translateMat1, name: 'u_translate1' },\n        { mat: translateMat2, name: 'u_translate2' },\n        { mat: scaleMat, name: 'u_scale' }\n      ],\n      size.width, size.height, // 这里的宽高是用来指示画图大小的，上面缩放后的宽高是用来计算坐标位置的对应关系，两者不必相等\n      true\n    );\n  }\n\n  const previewDraw = (center?: { x: number, y: number }) => {\n    const readRatio = 1.3;\n    const readW = Math.ceil(previewRect.width / readRatio); // 放大1.2倍，所以读取时读小一点\n    const readH = Math.ceil(previewRect.height / readRatio); // 放大1.2倍，所以读取时读小一点\n    const data = new Uint8ClampedArray(readW * readH * 4);\n    const centerX = center ? center.x : translate.x;\n    const centerY = center ? center.y : translate.y;\n    const left = centerX - readW / 2;\n    const bottom = centerY + readH / 2;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.readPixels(left, gl.canvas.height - bottom, readW, readH, gl.RGBA, gl.UNSIGNED_BYTE, data);\n    const previewTeture = gl.createTexture();\n    WEBGL.setTexture(gl, previewProgram, previewTeture, 'u_image', 3);\n    WEBGL.configTeture(gl, previewTeture, data, readW, readH);\n    WEBGL.DrawCube(gl, previewProgram, null, [\n      { mat: previewAPosData, name: 'a_position', drawType: gl.STATIC_DRAW },\n      { mat: aTexCoord, name: 'a_texCoord', drawType: gl.STATIC_DRAW },\n    ], [], gl.canvas.width, gl.canvas.height, true);\n  };\n\n  const output = (): string | undefined => {\n    if (!sourceInfo.src) return;\n    if (!saveInfo.canvas) {\n      saveInfo.canvas = document.createElement('canvas');\n      saveInfo.gl = saveInfo.canvas.getContext('webgl');\n      if (!saveInfo.gl) return;\n      saveInfo.drawProgram = WEBGL.createProgram(saveInfo.gl, vertextSource, fragmentSource);\n      if (!saveInfo.drawProgram) return;\n      saveInfo.texTure = WEBGL.createTexture(saveInfo.gl);\n      WEBGL.setTexture(saveInfo.gl, saveInfo.drawProgram, saveInfo.texTure, 'u_image', 0, sourceInfo.src);\n    }\n    if (!saveInfo.gl || !saveInfo.drawProgram) return;\n    saveInfo.canvas.width = sourceInfo.width;\n    saveInfo.canvas.height = sourceInfo.height;\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, patchBuffer);\n    const data = new Uint8ClampedArray(sourceInfo.patchW * sourceInfo.patchH * 4);\n    gl.readPixels(0, 0, sourceInfo.patchW, sourceInfo.patchH, gl.RGBA, gl.UNSIGNED_BYTE, data);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    const pTexture = saveInfo.gl.createTexture();\n    WEBGL.setTexture(saveInfo.gl, saveInfo.drawProgram, pTexture, 'u_image_patch', 1);\n    WEBGL.configTeture(saveInfo.gl, pTexture, data, sourceInfo.patchW, sourceInfo.patchH);\n    \n    const left =  0;\n    const right = sourceInfo.width;\n    const top = 0;\n    const bottom = sourceInfo.height;\n    const aPosData = [\n      left, top,\n      right, top,\n      left, bottom,\n      right, bottom,\n    ];\n    const roateMat = WEBGL.createRotateMat(0);\n    const translateMat = WEBGL.createTranslateMat(0, 0);\n    const scaleMat = WEBGL.createScaleMat(1);\n    const projMat = WEBGL.createProjectionMat(0, sourceInfo.width, 0, sourceInfo.height);\n    WEBGL.DrawCube(\n      saveInfo.gl, saveInfo.drawProgram, null,\n      [{ mat: aPosData, name: 'a_position', drawType: saveInfo.gl.STATIC_DRAW }, { mat: aTexCoord, name: 'a_texCoord', drawType: saveInfo.gl.STATIC_DRAW }],\n      [{ mat: translateMat, name: 'u_translate' }, { mat: roateMat, name: 'u_rotate' }, { mat: projMat, name: 'u_projection' }, { mat: scaleMat, name: 'u_scale' }],\n    );\n\n    const ret = saveInfo.canvas.toDataURL();\n    return ret;\n    // const a = document.createElement('a');\n    // a.href = ret;\n    // a.download = `IMG${Date.now()}.png`;\n    // const ev = new MouseEvent('click', {\n    //   bubbles: true,\n    //   cancelable: true,\n    //   view: window\n    // })\n    // a.dispatchEvent(ev);\n  };\n\n  touchListener.checkValid = ({ offsetX, offsetY }) => {\n    updateDraw();\n    gl.useProgram(pickProgram)\n    gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\n    const pixel = new Uint8Array(4);\n    gl.readPixels(offsetX, gl.canvas.height - offsetY, 1 , 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n    return WEBGL.isObjUidMatch(1, pixel);\n  };\n\n  touchListener.on('touchMove', ({ touches, preTouches }) => {\n    if (mode === SPLASH_MODE.MOVE) {\n      if (touchListener.touchType === touchListener.TOUCH_TYPE.SINGLE_TOUCH) {\n        const diffX = touches[0].x - preTouches[0].x;\n        const diffY = touches[0].y - preTouches[0].y;\n        translate.x += diffX;\n        translate.y += diffY;\n      } else if (touchListener.touchType === touchListener.TOUCH_TYPE.DOUBLE_TOUCH) {\n        const lenPow = Math.pow(touches[0].x - touches[1].x, 2) + Math.pow(touches[0].y - touches[1].y, 2);\n        const preLen = Math.pow(preTouches[0].x - preTouches[1].x, 2) + Math.pow(preTouches[0].y - preTouches[1].y, 2);\n        const diffScale = +Math.sqrt(lenPow / preLen).toFixed(2);\n        scale *= diffScale;\n        const center = { x: (touches[0].x + touches[1].x) / 2, y: (touches[0].y + touches[1].y) / 2 };\n        const preCenter = { x: (preTouches[0].x + preTouches[1].x) / 2, y: (preTouches[0].y + preTouches[1].y) / 2 };\n        // translate就是目前图案中心的位移\n        // 双指中心到图案中心的单位向量不变，长度等于放大缩小的倍数\n        // 所以有 (translate - center) = scale * (preTranslate - preCenter)\n        translate.x = diffScale * (translate.x - preCenter.x) + center.x;\n        translate.y = diffScale * (translate.y - preCenter.y) + center.y;\n      }\n      updateDraw();\n    } else {\n      if (touchListener.touchType === touchListener.TOUCH_TYPE.SINGLE_TOUCH) {\n        const { x, y } = touches[0];\n        const { x: preX, y: preY } = preTouches[0];\n        patchDraw({x, y}, { x: preX, y: preY });\n        updateDraw();\n        WEBGL.DrawCircle(gl, null, x, y, splashSize, 1, 1, 1, 0.2, 20, true);\n        // WEBGL.DrawCircle(gl, null, offsetX, offsetY, 10, 1, 0, 1, 1);\n        previewDraw({ x, y });\n      }\n    }\n  });\n\n  touchListener.on('touchEnd', ({ x, y }) => {\n    if (mode !== SPLASH_MODE.MOVE) {\n      updateDraw();\n      previewDraw({ x, y });\n    } else {\n      if (scale > maxScale) {\n        scale = maxScale;\n        updateDraw();\n      } else if (scale < minScale) {\n        scale = minScale;\n        updateDraw();\n      }\n    }\n  });\n\n  const destroy = () => {\n    touchListener.clear();\n  };\n\n  const switchMode = (m: SPLASH_MODE) => {\n    mode = m;\n    event.emit('splash-switch', mode);\n    if (m !== SPLASH_MODE.MOVE) {\n      if (m === SPLASH_MODE.COLOR) {\n        gl.useProgram(patchProgram);\n        const uMode = gl.getUniformLocation(patchProgram, 'u_mode');\n        gl.uniform1i(uMode, 0); // 0相应位置是彩色\n      } else if (m === SPLASH_MODE.GRAY) {\n        gl.useProgram(patchProgram);\n        const uMode = gl.getUniformLocation(patchProgram, 'u_mode');\n        gl.uniform1i(uMode, 1); // 1相应位置是灰色\n      }\n      updateDraw();\n    }\n  };\n\n  return {\n    reset: resetImage,\n    destroy,\n    switch: switchMode,\n    SPLASH_MODE,\n    event: { on: event.on, off: event.off },\n    output\n  };\n}\n\nexport default function init (opt: SplashOptions): Splash | undefined {\n  const container = opt.elm || window.document.body;\n  const canvas = window.document.createElement('canvas');\n  // canvas.style.background = 'red';\n  canvas.width = container.clientWidth;\n  canvas.height = container.clientHeight;\n  container.append(canvas);\n\n  return initWebgl(canvas);\n}","\nimport { defineComponent, onMounted, ref, reactive, nextTick } from 'vue';\nimport splashInit, { Splash, SPLASH_MODE } from './utils/splash';\n\nexport default defineComponent({\n  name: 'App',\n  setup() {\n    const splash = ref<Splash>();\n    const mode = ref<SPLASH_MODE>();\n    const showRet = ref(false);\n    const saveData = ref('');\n    const containerStyle = reactive({\n      height: ''\n    });\n\n    const selectImage = (e: Event) => {\n      if (!splash) {\n        (e.target as HTMLInputElement).value = '';\n        return;\n      }\n      const files = (e.target as HTMLInputElement).files;\n      if (files && files.length > 0) {\n        const file = files[0];\n        const reader = new FileReader();\n        reader.onload = (ev) => {\n          if (ev.target && ev.target.result) {\n            const img = new Image();\n            img.onload = () => {\n              splash.value?.reset(img);\n            }\n            img.src = ev.target.result as string;\n          }\n          (e.target as HTMLInputElement).value = '';\n        };\n        reader.readAsDataURL(file);\n      }\n    };\n\n    const switchMode = (mode: SPLASH_MODE) => {\n      splash.value?.switch(mode);\n    };\n\n    const onSave = () => {\n      const ret = splash.value?.output();\n      if (ret) {\n        saveData.value = ret;\n        showRet.value = true;\n      }\n    };\n\n    onMounted(() => {\n      containerStyle.height = `${window.innerHeight}px`;\n      nextTick(() => {\n        const divContainer = window.document.querySelector('#color-splash');\n        if (divContainer) {\n          splash.value = splashInit({ elm: divContainer });\n          splash.value?.event.on('splash-switch', (m) => {\n            mode.value = m;\n          })\n        }\n      });\n    });\n\n    return {\n      showRet,\n      saveData,\n      containerStyle,\n      selectImage,\n      splash,\n      switchMode,\n      SPLASH_MODE,\n      mode,\n      onSave\n    }\n  }\n});\n","import mod from \"-!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=6d18ad56&scoped=true&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&id=6d18ad56&prod&lang=css&\"\nimport style1 from \"./App.vue?vue&type=style&index=1&id=6d18ad56&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6d18ad56\",\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport App from './App.vue'\n\nVue.config.productionTip = false\n\nnew Vue({\n  render: h => h(App),\n}).$mount('#app')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkcolor_splash\"] = self[\"webpackChunkcolor_splash\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(4599); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["TOUCH_TYPE","render","_vm","this","_c","_self","_setupProxy","attrs","style","containerStyle","staticClass","_v","on","selectImage","class","actived","mode","SPLASH_MODE","COLOR","$event","switchMode","GRAY","MOVE","onSave","showRet","saveData","_e","staticRenderFns","XEvent","constructor","nameList","eventList","forEach","name","uidMap","eventMap","cb","events","cuid","undefined","off","uid","emit","arg","Object","keys","key","fn","clear","TouchListener","elm","super","SINGLE_TOUCH","e","preventDefault","curTouch","window","clearTimeout","touchTimer","setTimeout","touches","length","touch0","touch1","ret","checkValid","offsetX","clientX","offsetLeft","offsetY","clientY","offsetTop","touchType","x","y","DOUBLE_TOUCH","preTouches","removeEventListener","onTouchStart","onTouchMove","onTouchEnd","rect","getBoundingClientRect","top","left","addEventListener","vertextSource","fragmentSource","splashVertextSource","splashFragmentSource","pickVertextSource","pickFragmentSource","previewVertextSource","previewFragmentSource","circleVertextSource","colorFragmentSource","webgl","document","createElement","getContext","WebGLRenderingContext","circleProgram","createProgram","gl","vSource","fSource","vertextShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","program","attachShader","linkProgram","createFrameBuffer","arg1","arg2","frameBuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","w","canvas","width","h","height","curTexture","getParameter","TEXTURE_BINDING_2D","texture","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","bindTexture","source","configTeture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","setTexture","uniform","index","useProgram","uImage","getUniformLocation","uniform1i","activeTexture","setAttribute","data","attribute","drawType","size","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","aLocation","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","setUniformMat","uniformLocation","uniformMatrix4fv","setUniformVec4","uniform4f","getObjUid","isObjUidMatch","id","createProjectionMat","right","bottom","createRotateMat","rotate","Math","PI","cos","sin","createTranslateMat","createScaleMat","scale","DrawCube","attributes","uniforms","keep","viewport","mat","clearColor","COLOR_BUFFER_BIT","drawArrays","TRIANGLE_STRIP","DrawCircle","radius","r","g","b","a","count","fill","projMat","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","radiusLoc","uniform1f","radianUnit","radianData","flagData","i","push","drawShape","LINE_LOOP","drawCount","unshift","TRIANGLE_FAN","STATIC_DRAW","disable","splashEvent","SplashEvent","initWebgl","event","translate","minScale","maxScale","splashSize","saveInfo","drawProgram","texTure","sourceInfo","patchW","patchH","src","WEBGL","pickProgram","patchProgram","previewProgram","patchBuffer","patchTexture","touchListener","picTexture","aTexCoord","projectionMat","scaleUnitW","scaleUnitH","previewRect","round","previewAPosData","updateDraw","aPosData","roateMat","translateMat","scaleMat","DYNAMIC_DRAW","resetImage","ratioW","ratioH","ratio","min","patchDraw","p1","p2","translateMat1","translateMat2","p1p2","len","sqrt","pow","v1","v2","p1v1","p1v2","p2v1","p2v2","previewDraw","center","readRatio","readW","ceil","readH","Uint8ClampedArray","centerX","centerY","readPixels","previewTeture","output","pTexture","toDataURL","pixel","Uint8Array","diffX","diffY","lenPow","preLen","diffScale","toFixed","preCenter","preX","preY","destroy","m","uMode","reset","switch","init","opt","container","body","clientWidth","clientHeight","append","defineComponent","setup","splash","ref","reactive","target","value","files","file","reader","FileReader","onload","ev","result","img","Image","readAsDataURL","onMounted","innerHeight","nextTick","divContainer","querySelector","splashInit","component","Vue","App","$mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","deferred","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","j","every","splice","n","getter","__esModule","d","definition","o","defineProperty","enumerable","get","globalThis","Function","obj","prop","prototype","hasOwnProperty","call","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","bind","__webpack_exports__"],"sourceRoot":""}